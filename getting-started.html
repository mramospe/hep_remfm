
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Getting started &#8212; hep_rfm 0.0.0.dev4 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Functions and classes" href="functions-and-classes.html" />
    <link rel="prev" title="Introduction" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="getting-started">
<h1>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<p>Once you have passed through the <a class="reference internal" href="index.html#installation"><span class="std std-ref">Installation</span></a> procedure, you are ready to
start setting-up your file system.
Usually this consists on two different steps.
One is aimed to define the location of the files in different hosts, while
the other covers the accesibility of the files, and their update through
<a class="reference external" href="https://www.python.org/">python</a>.</p>
<div class="section" id="setting-up-the-system">
<span id="setup"></span><h2>Setting-up the system<a class="headerlink" href="#setting-up-the-system" title="Permalink to this headline">¶</a></h2>
<p>The first thing needed to profit from the different tools offered in this
package is to start <strong>defining the set of files</strong> to work with, this means,
a <a class="reference internal" href="api/hep_rfm.Table.html#hep_rfm.Table" title="hep_rfm.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">hep_rfm.Table</span></code></a> object.
A <a class="reference internal" href="api/hep_rfm.Table.html#hep_rfm.Table" title="hep_rfm.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">hep_rfm.Table</span></code></a> is simply a dictionary with strings as keys,
corresponding to the names of the files, and as values,
<a class="reference internal" href="api/hep_rfm.FileInfo.html#hep_rfm.FileInfo" title="hep_rfm.FileInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">hep_rfm.FileInfo</span></code></a> objects.
The latter stores the information needed by this package to work.
This information corresponds to:</p>
<ul class="simple">
<li><strong>Name</strong>: this is the user identifier of the file. In a table there can only be one file with the same name.</li>
<li><strong>Path</strong>: the path to the file. This can be either a local or remote path.</li>
<li><strong>Protocol ID (PID)</strong>: name of the protocol to be used to access the file.</li>
<li><strong>Time-stamp</strong>: the system time-stamp of the file, stored as a float value. This will be needed to determine which files are newer.</li>
<li><strong>File ID (FID)</strong>: this is the result of hashing the file. For this purpose, the function <a class="reference internal" href="api/hep_rfm.rfm_hash.html#hep_rfm.rfm_hash" title="hep_rfm.rfm_hash"><code class="xref py py-func docutils literal notranslate"><span class="pre">hep_rfm.rfm_hash()</span></code></a> is used. The result allows to evaluate the integrity of the file, and to determine if two files aiming to be the same are different. Afterwards, the time-stamp will be used to determine which one is newer.</li>
</ul>
<p>Generally, it will become difficult for the user to generate a table by hand
even using the functions here provided.
A much easier method, makes use of the script <strong>hep-rfm-table</strong>, supplied
together with this package.
<strong>This script allows to create, modify and update tables directly from the
terminal</strong>, avoiding the creation of custom python scripts for that purpose.
To start-up, create a empty directory and then type:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> hep-rfm-table -h
</pre></div>
</div>
<p>You can now see the different options we have to work with tables.
We will start by creating a new table.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> hep-rfm-table create table.db
<span class="gp">$</span> ls
<span class="go">table.db</span>
</pre></div>
</div>
<p>We can see the contents on the table at any point by typing</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> hep-rfm-table display table.db
<span class="go">Running &quot;hep-rfm-table&quot; from hep_rfm 0.0.0.dev4</span>
<span class="go">- Table created with hep_rfm 0.0.0.dev4</span>
<span class="go">- Last update: 2019-04-12 12:54:41.593218</span>
<span class="go">- Contents:</span>
<span class="go">No entries found</span>
</pre></div>
</div>
<p>which is telling us that there are no entries in the table.
Let’s add some then.
We will start by creating a new file, with some content, and then we will add it to the table.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;My first table file&quot;</span> &gt;&gt; file1.txt
<span class="gp">$</span> hep-rfm-table add table.db file1 file1.txt
<span class="gp">$</span> hep-rfm-table display table.db
<span class="go">Running &quot;hep-rfm-table&quot; from hep_rfm 0.0.0.dev4</span>
<span class="go">- Table created with hep_rfm 0.0.0.dev4</span>
<span class="go">- Last update: 2019-04-12 12:54:41.904134</span>
<span class="go">- Contents:</span>
<span class="go">name         path                                                    pid     tmstp                           fid</span>
<span class="go">file1        /home/user/rfm/file1.txt        local   2019-04-12 12:54:41.755092      202444300d48c9387406...</span>
</pre></div>
</div>
<p>So we have added our first file.
In order to do this we had to give the name of the file and the path to it.
You can see that we have added a file named <em>file1</em>, that the path to the file has been automatically expanded, to match a global path, and that the time-stamp and file ID have been extracted.
Now let’s create two more files and add them to the table as well.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;This is the second file&quot;</span> &gt;&gt; file2.txt
<span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;This is the third file&quot;</span> &gt;&gt; file3.txt
<span class="gp">$</span> hep-rfm-table add-massive table.db file2.txt file3.txt
<span class="go">Running &quot;hep-rfm-table&quot; from hep_rfm 0.0.0.dev4</span>
<span class="go">- Table created with hep_rfm 0.0.0.dev4</span>
<span class="go">- Last update: 2019-04-12 12:54:42.226468</span>
<span class="go">- Contents:</span>
<span class="go">name         path                                                    pid     tmstp                           fid</span>
<span class="go">file1        /home/user/rfm/file1.txt        local   2019-04-12 12:54:41.755092      202444300d48c9387406...</span>
<span class="go">file2        /home/user/rfm/file2.txt        local   2019-04-12 12:54:42.067091      cad9a71a7902d13f44db...</span>
<span class="go">file3        /home/user/rfm/file3.txt        local   2019-04-12 12:54:42.067091      ce53225da9b363e3db71...</span>
</pre></div>
</div>
<p>With this command one can add easily new files, given only their paths, where
the names will be extracted from the name of the files themselves, without
extensions.
Frequently one will have a whole system of files stored in different directories
and subdirectories.
This can easlity handed running another mode, which will take all the files
within a directory and add them to the table.
We can also specify a regular expression, so only the files whose names
(including the extension) match that given.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> mkdir -p subdir/subsubdir
<span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;This is the fourth file&quot;</span> &gt;&gt; subdir/file4.txt
<span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;This is the fifth file&quot;</span> &gt;&gt; subdir/subsubdir/file5.txt
<span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;This is the sixth file&quot;</span> &gt;&gt; subdir/subsubdir/file6.dt
<span class="gp">$</span> hep-rfm-table add-from-dir table.db . --regex .*.txt
<span class="gp">$</span> hep-rfm-table display table.db
<span class="go">Running &quot;hep-rfm-table&quot; from hep_rfm 0.0.0.dev4</span>
<span class="go">- Table created with hep_rfm 0.0.0.dev4</span>
<span class="go">- Last update: 2019-04-12 12:54:42.643200</span>
<span class="go">- Contents:</span>
<span class="go">name         path                                                                    pid     tmstp                           fid</span>
<span class="go">file1        /home/user/rfm/file1.txt                        local   2019-04-12 12:54:41.755092      202444300d48c9387406...</span>
<span class="go">file2        /home/user/rfm/file2.txt                        local   2019-04-12 12:54:42.067091      cad9a71a7902d13f44db...</span>
<span class="go">file3        /home/user/rfm/file3.txt                        local   2019-04-12 12:54:42.067091      ce53225da9b363e3db71...</span>
<span class="go">file4        /home/user/rfm/subdir/file4.txt                 local   2019-04-12 12:54:42.487090      8a9dcf90d2a0bcb95d8f...</span>
<span class="go">file5        /home/user/rfm/subdir/subsubdir/file5.txt       local   2019-04-12 12:54:42.487090      86f2f9bb445df1e62818...</span>
</pre></div>
</div>
<p>You can see that we have included all files in the current directory, but from
<em>file6.dt</em>, which did not match the given regular expression.
If we remove the regular expression requirement, then it is included</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> hep-rfm-table add-from-dir table.db .
<span class="gp">$</span> hep-rfm-table display table.db
<span class="go">Running &quot;hep-rfm-table&quot; from hep_rfm 0.0.0.dev4</span>
<span class="go">- Table created with hep_rfm 0.0.0.dev4</span>
<span class="go">- Last update: 2019-04-12 12:54:42.970372</span>
<span class="go">- Contents:</span>
<span class="go">name         path                                                                    pid     tmstp                           fid</span>
<span class="go">file1        /home/user/rfm/file1.txt                        local   2019-04-12 12:54:41.755092      202444300d48c9387406...</span>
<span class="go">file2        /home/user/rfm/file2.txt                        local   2019-04-12 12:54:42.067091      cad9a71a7902d13f44db...</span>
<span class="go">file3        /home/user/rfm/file3.txt                        local   2019-04-12 12:54:42.067091      ce53225da9b363e3db71...</span>
<span class="go">file4        /home/user/rfm/subdir/file4.txt                 local   2019-04-12 12:54:42.487090      8a9dcf90d2a0bcb95d8f...</span>
<span class="go">file5        /home/user/rfm/subdir/subsubdir/file5.txt       local   2019-04-12 12:54:42.487090      86f2f9bb445df1e62818...</span>
<span class="go">file6        /home/user/rfm/subdir/subsubdir/file6.dt        local   2019-04-12 12:54:42.487090      5bd329091112ab1c7125...</span>
<span class="go">table        /home/user/rfm/table.db                         local   2019-04-12 12:54:42.639090      e00f13b293897a73ea58...</span>
</pre></div>
</div>
<p>You can see that we have also included the table itself.
This is very dangerous, and must be avoided, since it will lead to a replacement
of the table files when working with <a class="reference internal" href="api/hep_rfm.Manager.html#hep_rfm.Manager" title="hep_rfm.Manager"><code class="xref py py-class docutils literal notranslate"><span class="pre">hep_rfm.Manager</span></code></a>.
Usually it is preferred that the files are located in a sub-directory, and the
table file in the parent directory, so there are no conflicts.
To return to a safe status, let’s remove the table entry, put everything on a
new directory and add the files again.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> hep-rfm-table remove table.db --files table
<span class="gp">$</span> hep-rfm-table display table.db
<span class="go">Running &quot;hep-rfm-table&quot; from hep_rfm 0.0.0.dev4</span>
<span class="go">- Table created with hep_rfm 0.0.0.dev4</span>
<span class="go">- Last update: 2019-04-12 12:54:43.297370</span>
<span class="go">- Contents:</span>
<span class="go">name         path                                                                    pid     tmstp                           fid</span>
<span class="go">file1        /home/user/rfm/file1.txt                        local   2019-04-12 12:54:41.755092      202444300d48c9387406...</span>
<span class="go">file2        /home/user/rfm/file2.txt                        local   2019-04-12 12:54:42.067091      cad9a71a7902d13f44db...</span>
<span class="go">file3        /home/user/rfm/file3.txt                        local   2019-04-12 12:54:42.067091      ce53225da9b363e3db71...</span>
<span class="go">file4        /home/user/rfm/subdir/file4.txt                 local   2019-04-12 12:54:42.487090      8a9dcf90d2a0bcb95d8f...</span>
<span class="go">file5        /home/user/rfm/subdir/subsubdir/file5.txt       local   2019-04-12 12:54:42.487090      86f2f9bb445df1e62818...</span>
<span class="go">file6        /home/user/rfm/subdir/subsubdir/file6.dt        local   2019-04-12 12:54:42.487090      5bd329091112ab1c7125...</span>
<span class="gp">$</span> mkdir files
<span class="gp">$</span> mv subdir *.txt files/.
<span class="gp">$</span> hep-rfm-table add-from-dir table.db files
<span class="gp">$</span> hep-rfm-table display table.db
<span class="go">Running &quot;hep-rfm-table&quot; from hep_rfm 0.0.0.dev4</span>
<span class="go">- Table created with hep_rfm 0.0.0.dev4</span>
<span class="go">- Last update: 2019-04-12 12:54:43.628105</span>
<span class="go">- Contents:</span>
<span class="go">name         path                                                                            pid     tmstp                           fid</span>
<span class="go">file1        /home/user/rfm/files/file1.txt                  local   2019-04-12 12:54:41.755092      202444300d48c9387406...</span>
<span class="go">file2        /home/user/rfm/files/file2.txt                  local   2019-04-12 12:54:42.067091      cad9a71a7902d13f44db...</span>
<span class="go">file3        /home/user/rfm/files/file3.txt                  local   2019-04-12 12:54:42.067091      ce53225da9b363e3db71...</span>
<span class="go">file4        /home/user/rfm/files/subdir/file4.txt           local   2019-04-12 12:54:42.487090      8a9dcf90d2a0bcb95d8f...</span>
<span class="go">file5        /home/user/rfm/files/subdir/subsubdir/file5.txt local   2019-04-12 12:54:42.487090      86f2f9bb445df1e62818...</span>
<span class="go">file6        /home/user/rfm/files/subdir/subsubdir/file6.dt  local   2019-04-12 12:54:42.487090      5bd329091112ab1c7125...</span>
</pre></div>
</div>
<p>So now the entry <em>table</em> has been removed.
The idea behind this is not only to have a way to keep our data files organized,
but also to be able to <strong>keep files synchronized</strong> in different hosts.
This means that we will have a <em>main</em> place, where we would be preferably
placing our new versions of the files, and from there we would be updating the
other locations.
In order to do any modification on a remote we need to authenticate, and
we would need to do it for every single file we want to update.
Using <strong>ssh keys</strong> is thus the preferred way to handle this inconvenient,
or make sure that the target host is directly accessible from your current one.
In the <strong>remote host</strong>, we will need to have <strong>another table</strong> with the paths
in it.
However, we should <strong>specify the path but not the time-stamp or file ID</strong>, since
we will not have a file there.
This is solved adding the <em>--bare</em> option to <em>add</em> and <em>add-massive</em>.
The mode <em>add-from-dir</em> will not make sense to be used here, since we do not
have files there.
This means that we could type</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ssh username@host.com
<span class="gp">$</span> mkdir files
<span class="gp">$</span> hep-rfm-table create table.db
<span class="gp">$</span> hep-rfm-table add table.db files/file1.txt --bare --remote ssh @host.com
<span class="gp">$</span> hep-rfm-table display table.db
<span class="go">Running &quot;hep-rfm-table&quot; from hep_rfm 0.0.0.dev4</span>
<span class="go">- Table created with hep_rfm 0.0.0.dev4</span>
<span class="go">- Last update: 2019-04-12 12:54:43.928512</span>
<span class="go">- Contents:</span>
<span class="go">name         path                                    pid     tmstp   fid</span>
<span class="go">file1        @host.com:/home/user/rfm/files/file1.txt        local   0.0     none</span>
</pre></div>
</div>
<p>So you can see that the time-stamp and file ID are filled with default values,
which are chosen so they do not cause conflicts.
Note that we have <strong>specified the remote</strong> with the protocol ID <em>ssh</em> and the prepending string <em>&#64;host.com</em>.
This will be needed afterwards to correctly update the files.
The other files will be added in a row, by typing</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> hep-rfm-table add-massive table.db <span class="sb">`</span><span class="k">for</span> i in <span class="o">{</span><span class="m">2</span>..6<span class="o">}</span><span class="p">;</span><span class="k">do</span> <span class="nb">echo</span> files/file<span class="nv">$i</span>.txt<span class="p">;</span> <span class="k">done</span><span class="sb">`</span> --bare --remote ssh @host.com
<span class="gp">$</span> hep-rfm-table display table.db
<span class="go">Running &quot;hep-rfm-table&quot; from hep_rfm 0.0.0.dev4</span>
<span class="go">- Table created with hep_rfm 0.0.0.dev4</span>
<span class="go">- Last update: 2019-04-12 12:54:44.011354</span>
<span class="go">- Contents:</span>
<span class="go">name         path                                    pid     tmstp   fid</span>
<span class="go">file1        @host.com:/home/user/rfm/files/file1.txt        local   0.0     none</span>
<span class="go">file2        @host.com:/home/user/rfm/files/file2.txt        local   0.0     none</span>
<span class="go">file3        @host.com:/home/user/rfm/files/file3.txt        local   0.0     none</span>
<span class="go">file4        @host.com:/home/user/rfm/files/file4.txt        local   0.0     none</span>
<span class="go">file5        @host.com:/home/user/rfm/files/file5.txt        local   0.0     none</span>
<span class="go">file6        @host.com:/home/user/rfm/files/file6.txt        local   0.0     none</span>
</pre></div>
</div>
<p>Note that here we have included all the files in the same directory.
Files do not need to have similar paths in different hosts.</p>
<p>Sometimes we might need to replicate a table, this is, create an entire copy of
the structure of one table (the system of directories and file names) into
another.
This is done through the <em>replicate</em> mode:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> hep-rfm-table create rtable.db
<span class="gp">$</span> mkdir rfiles
<span class="gp">$</span> hep-rfm-table replicate rtable.db table.db files rfiles
<span class="gp">$</span> hep-rfm-table display rtable.db
<span class="go">Running &quot;hep-rfm-table&quot; from hep_rfm 0.0.0.dev4</span>
<span class="go">- Table created with hep_rfm 0.0.0.dev4</span>
<span class="go">- Last update: 2019-04-12 12:54:44.123548</span>
<span class="go">- Contents:</span>
<span class="go">name         path                                                                            pid     tmstp                   fid</span>
<span class="go">file1        /home/user/rfm/rfiles/file1.txt                         local   1970-01-01 01:00:00     none</span>
<span class="go">file2        /home/user/rfm/rfiles/file2.txt                         local   1970-01-01 01:00:00     none</span>
<span class="go">file3        /home/user/rfm/rfiles/file3.txt                         local   1970-01-01 01:00:00     none</span>
<span class="go">file4        /home/user/rfm/rfiles/subdir/file4.txt                  local   1970-01-01 01:00:00     none</span>
<span class="go">file5        /home/user/rfm/rfiles/subdir/subsubdir/file5.txt        local   1970-01-01 01:00:00     none</span>
<span class="go">file6        /home/user/rfm/rfiles/subdir/subsubdir/file6.dt         local   1970-01-01 01:00:00     none</span>
</pre></div>
</div>
<p>You can see that we have created a new table <em>rtable.db</em> with the same
structure as <em>table.txt</em>, but this time pointing to bare files in the directory
<em>rfiles</em>.
There is some policy regarding adding new files through the <em>replicate</em> mode
if they already exist in the table.
Options to raise and error, replace the contents or omit the changes are
contemplated.</p>
<p>For more information, you can always run any mode with <em>-h</em>.
One we have done this, we are ready to see how we can access the files
and keep data updated in both sites, in the next section: <a class="reference internal" href="#file-management"><span class="std std-ref">File management</span></a>.</p>
</div>
<div class="section" id="file-management">
<span id="id1"></span><h2>File management<a class="headerlink" href="#file-management" title="Permalink to this headline">¶</a></h2>
<p>In section <a class="reference internal" href="#setup"><span class="std std-ref">Setting-up the system</span></a> we saw how to set-up two tables in two different hosts,
one local and one remote, with different files.
Our final goal is to <strong>access these files from python</strong>.
In the local host we can do it by writing</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">hep_rfm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span> <span class="o">=</span> <span class="n">hep_rfm</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/home/user/rfm/table.db&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="go">[&#39;file1&#39;, &#39;file2&#39;, &#39;file3&#39;, &#39;file4&#39;, &#39;file5&#39;, &#39;file6&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;file1&#39;</span><span class="p">]</span>
<span class="go">FileInfo(name=&#39;file1&#39;, protocol_path=LocalPath(path=&#39;/home/user/rfm/files/file1.txt&#39;), marks=FileMarks(tmstp=1540986365.8954208, fid=&#39;202444300d48c9387406493590cc693a81c011f1c112d7c8916b27ff9e5daad32a679e4471974b2169c4d22738a17a92405d8948bf5b1d2d8b69c235a65f991b&#39;))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;file1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">protocol_path</span><span class="o">.</span><span class="n">path</span>
<span class="go">/home/user/rfm/files/file1.txt</span>
</pre></div>
</div>
<p>so we can access all the information.
We could also modify the information of the table, make copies, and then
write them using the method <a class="reference internal" href="api/hep_rfm.Table.html#hep_rfm.Table.write" title="hep_rfm.Table.write"><code class="xref py py-meth docutils literal notranslate"><span class="pre">hep_rfm.Table.write()</span></code></a>.
To automatically update the table using the local files, we could
simply call <a class="reference internal" href="api/hep_rfm.Table.html#hep_rfm.Table.updated" title="hep_rfm.Table.updated"><code class="xref py py-meth docutils literal notranslate"><span class="pre">hep_rfm.Table.updated()</span></code></a>, and we would obtain
the updated version of the table.</p>
<p>From now on, we will consider that we are working in the local host.
To manage both tables, we will create a <a class="reference internal" href="api/hep_rfm.Manager.html#hep_rfm.Manager" title="hep_rfm.Manager"><code class="xref py py-class docutils literal notranslate"><span class="pre">hep_rfm.Manager</span></code></a> class, and
register the two tables</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mgr</span> <span class="o">=</span> <span class="n">hep_rfm</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mgr</span><span class="o">.</span><span class="n">add_table</span><span class="p">(</span><span class="s1">&#39;/home/user/rfm/table.db&#39;</span><span class="p">,</span> <span class="s1">&#39;local&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mgr</span><span class="o">.</span><span class="n">add_table</span><span class="p">(</span><span class="s1">&#39;@host.com:/home/user/table.db&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we have the two tables registered.
Calling the method <a class="reference internal" href="api/hep_rfm.Manager.html#hep_rfm.Manager.available_table" title="hep_rfm.Manager.available_table"><code class="xref py py-meth docutils literal notranslate"><span class="pre">hep_rfm.Manager.available_table()</span></code></a>, we will
obtain the table corresponding to the local path.
This means that in the local host we will get “/home/user/rfm/table.db”,
and in the remote “/home/user/table.db”.
With this information we can create the table, and work with the files
from there.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">table</span> <span class="o">=</span> <span class="n">mgr</span><span class="o">.</span><span class="n">available_table</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="go">[&#39;file1&#39;, &#39;file2&#39;, &#39;file3&#39;, &#39;file4&#39;, &#39;file5&#39;, &#39;file6&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hep_rfm</span><span class="o">.</span><span class="n">available_working_path</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;file1&#39;</span><span class="p">])</span>
<span class="go">/home/user/rfm/files/file1.txt</span>
</pre></div>
</div>
<p>The advantage of using the <a class="reference internal" href="api/hep_rfm.Manager.html#hep_rfm.Manager" title="hep_rfm.Manager"><code class="xref py py-class docutils literal notranslate"><span class="pre">hep_rfm.Manager</span></code></a> instance, is that
we do not need to care whether we are in the local or remote host.
This turns powerful when having code on a <a class="reference external" href="https://git-scm.com/">git</a>
repository, which is present in both local and remote hosts, since one
could work in each host without really caring about the location of the
files.
Lastly, and probably one of the most useful methods of the class
concerns the method <a class="reference internal" href="api/hep_rfm.Manager.html#hep_rfm.Manager.update" title="hep_rfm.Manager.update"><code class="xref py py-class docutils literal notranslate"><span class="pre">hep_rfm.Manager.update</span></code></a>.
This method allows to update all the different tables stored in the manager.</p>
<ol class="arabic simple">
<li>First, the <strong>tables are copied</strong> to the current host.</li>
<li>On a second step, the <strong>file IDs</strong> of the files <strong>are compared</strong> among the different
tables.</li>
<li>If there is a mismatch, then the <strong>time-stamps are checked</strong>, so the newest
version is determined.</li>
<li>After, the <strong>files are copied</strong> to each outdated location.</li>
<li>Finally, the <strong>tables</strong> in the outdated locations <strong>are updated</strong>.</li>
</ol>
<p>The general idea is to have a python file in your module with the tables
begin defined, so it serves as an access point to the data and also to
update it.
An example of such module would be</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mgr</span> <span class="o">=</span> <span class="n">hep_rfm</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>
<span class="n">mgr</span><span class="o">.</span><span class="n">add_table</span><span class="p">(</span><span class="s1">&#39;/home/user/rfm/table.db&#39;</span><span class="p">,</span> <span class="s1">&#39;local&#39;</span><span class="p">)</span>
<span class="n">mgr</span><span class="o">.</span><span class="n">add_table</span><span class="p">(</span><span class="s1">&#39;@host.com:/home/user/table.db&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh&#39;</span><span class="p">)</span>

<span class="n">table</span> <span class="o">=</span> <span class="n">mgr</span><span class="o">.</span><span class="n">available_table</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">mgr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">modifiers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ssh_usernames&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;host.com&#39;</span><span class="p">:</span> <span class="s1">&#39;username&#39;</span><span class="p">}})</span>
</pre></div>
</div>
<p>so if we put this in a file called “data.py”, we can access it via
<code class="code docutils literal notranslate"><span class="pre">import</span> <span class="pre">data</span></code> and then <code class="code docutils literal notranslate"><span class="pre">data.table</span></code> would allow us to
access the real paths of the files.
On the other hand, the samples would be updated executing <code class="code docutils literal notranslate"><span class="pre">python</span> <span class="pre">data.py</span></code>.
Note that we have specified the keyword argument <em>modifiers</em>.
This allows us to specify in a dictionary the user-name to be used for each ssh
host, for example.</p>
</div>
<div class="section" id="limitations">
<span id="id2"></span><h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h2>
<p>The biggest limiting factor concerns hashing <strong>very-large files</strong>.
The functions here present are optimized to work as well with <strong>large files</strong>
(those that can not be completely loaded in memory).
However, for <strong>very-large files (&gt; 20 GB)</strong>, the hashing process might become
very slow depending on the machine.</p>
<p>Another limitation has to do with the <strong>xrootd protocol</strong>.
Oftenly, with the <strong>xrootd protocol</strong> we are <strong>not allowed to copy</strong>
(via <em>xrdcp</em>) a file from the local system to the remote.
In case your project uses files which are on a site accessible via
<strong>xrootd protocol</strong>, you might need to define that as your <em>main</em> site.
Uploading the new files to this site and then running the update script
from it would be probably the way to go.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">hep_rfm</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-the-system">Setting-up the system</a></li>
<li class="toctree-l2"><a class="reference internal" href="#file-management">File management</a></li>
<li class="toctree-l2"><a class="reference internal" href="#limitations">Limitations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="functions-and-classes.html">Functions and classes</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Introduction</a></li>
      <li>Next: <a href="functions-and-classes.html" title="next chapter">Functions and classes</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Miguel Ramos Pernas.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/getting-started.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>